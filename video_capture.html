<!DOCTYPE html>
<html>
    <head>
		<meta charset="utf-8">
        <title>Video Capturer</title>
		<style>
			video,
			input {
			  display: block;
			}
		</style>
    </head>
    <body>
<h1>Video Capturer</h1>

<h3>Upload a video</h3>
<input id="videoInput" type="file" accept="video/*" />

<h3>Output Size</h3>
<input type="number" id="outputSizeInput" min="5" max="400" value="200">

<h3>Frames Captured Per Second</h3>
<input type="number" id="captureRateInput" min="1" max="60" value="10">

<p id="stats">STATS: </p>
<button type="button" onclick="printData()">Print Data</button>
<p id="results">RESULTS: </p>

<video id="video" controls autoplay controls muted width="400px" height="400px" style="display:inline-block;"></video>

<canvas id="canvas" width="400px" height="400px" style="background:rgb(51, 51, 51); display:inline-block;"></canvas>


<script>
function localFileVideoPlayer() {
  var URL = window.URL || window.webkitURL;
  var playSelectedFile = function(event) {
    var file = this.files[0];
    var videoNode = document.querySelector('video');

    videoNode.src = URL.createObjectURL(file);
  }
  var inputNode = document.querySelector('input');
  inputNode.addEventListener('change', playSelectedFile, false);
}
localFileVideoPlayer();



var printData = function(){
	var element = document.createElement("p");
	element.innerHTML = "<p style='background: rgb(225, 225, 225);'>" + resultData + "];</p>";
	document.getElementById("results").innerHTML = "";
	document.getElementById("results").appendChild(element); 
};

var canvas = document.getElementById('canvas'), ctx = canvas.getContext('2d');
var video = document.getElementById('video');

var outputSize = 400;

var resultData = "[";

var frameCount = 0;

var captureRate = 0;
var intervalSpeed = 0;

var draw = function() {
	if(document.getElementById("videoInput").value.length > 0 && !video.paused){
		
		outputSize = document.getElementById("outputSizeInput").value;
		if(outputSize < 5){
			outputSize = 5;
		}else if(outputSize > 400){
			outputSize = 400;
		}
		
		captureRate = document.getElementById("captureRateInput").value;
		if(captureRate < 1){
			captureRate = 1;
		}else if(captureRate > 60){
			captureRate = 60;
		}
		
		var bigger = video.width;
		if(video.height > bigger){
			bigger = video.height;
		}
		var scaleFactor = outputSize/bigger;
		var videoW = Math.floor(video.width*scaleFactor);
		var videoH = Math.floor(video.height*scaleFactor);
		
		ctx.clearRect(0, 0, 400, 400);
		
		ctx.drawImage(video, 0, 0, videoW, videoH);
		
		var imgData = ctx.getImageData(0, 0, videoW, videoH).data;
		
		if(imgData[0] > 0){
			resultData += '[' + imgData + '],';
		}
		
		var kb = Math.round(resultData.length/1000);
		var element = document.createElement("p");
		element.innerHTML = "File Size: " + kb + "kb";
		document.getElementById("stats").innerHTML = "";
		document.getElementById("stats").appendChild(element); 
		if(kb > 750){
			document.getElementById("stats").style.color = "red";
		}
		
		if(Math.ceil(1000/captureRate) !== intervalSpeed){
			clearInterval(run);
			intervalSpeed = Math.ceil(1000/captureRate);
			run = setInterval(draw, intervalSpeed);
		}
	}
	
	frameCount++;
}

var run = setInterval(draw, intervalSpeed);


</script>
    </body>
</html>
